webpackJsonp([7],{"+wd3":function(e,t){},AjvX:function(e,t){},Lk4z:function(e,t,i){"use strict";var a={props:{tableData:Array,tableLabel:Array,config:Object},data:function(){return{pageSize:null}},methods:{handleEdit:function(e){this.$emit("edit",e)},handleDelete:function(e){this.$emit("del",e)},sizeChange:function(e){this.$store.commit("changePageSize",e),this.$emit("changeSizePage")},prev:function(e){this.$store.commit("changePage",e),this.$emit("changePage")},next:function(e){this.$store.commit("changePage",e),this.$emit("changePage")},change:function(e){this.$store.commit("changePage",e),this.$emit("changePage")},changeState:function(e){this.$emit("changState",e)},selectRows:function(e){this.$emit("selectRow",e)}}},o={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"common-table"},[i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.config.loading,expression:"config.loading"}],staticClass:"tableClass",attrs:{data:e.tableData,border:"",height:"380",stripe:""},on:{"selection-change":e.selectRows}},[i("el-table-column",{attrs:{prop:"date",label:"序号",width:"70"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",{staticStyle:{"margin-left":"10px",padding:"0"}},[e._v(e._s(t.$index+1))])]}}])}),e._v(" "),i("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),e._l(e.tableLabel,function(t){return i("el-table-column",{key:t.prop,attrs:{label:t.label,width:"180","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(a){return[i("el-tooltip",{attrs:{content:a.row.ustate?"已启用":"已禁用",placement:"right"}},["state"==t.prop?i("el-switch",{attrs:{"active-value":!0,"inactive-value":!1},on:{change:function(t){return e.changeState(a.row)}},model:{value:a.row.ustate,callback:function(t){e.$set(a.row,"ustate",t)},expression:"scope.row.ustate"}}):e._e()],1),e._v(" "),i("span",{staticStyle:{"margin-left":"10px","font-size":"12px"}},[e._v("\n                    "+e._s(a.row[t.prop])+"\n                    "),"phone"==t.prop?i("i",{staticClass:"el-icon-phone-outline"}):e._e(),e._v(" "),"phone"==t.prop?i("i",{staticClass:"el-icon-s-promotion"}):e._e()])]}}],null,!0)})}),e._v(" "),i("el-table-column",{attrs:{label:"操作",width:"150",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{size:"mini"},on:{click:function(i){return e.handleEdit(t.row)}}},[e._v(e._s(e.config.type))]),e._v(" "),i("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(i){return e.handleDelete(t.row)}}},[e._v("删除")])]}}])})],2),e._v(" "),i("el-pagination",{attrs:{"current-page":e.config.page,"page-sizes":[20,50,200,500],"page-size":e.config.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.config.total},on:{"size-change":e.sizeChange,"prev-click":e.prev,"next-click":e.next,"current-change":e.change,"update:currentPage":function(t){return e.$set(e.config,"page",t)},"update:current-page":function(t){return e.$set(e.config,"page",t)},"update:pageSize":function(t){return e.$set(e.config,"pageSize",t)},"update:page-size":function(t){return e.$set(e.config,"pageSize",t)}}})],1)},staticRenderFns:[]};var n=i("VU/8")(a,o,!1,function(e){i("AjvX")},null,null);t.a=n.exports},YMOT:function(e,t){},"i/Eh":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i("woOf"),o=i.n(a),n=i("Dd8w"),s=i.n(n),l=i("WNPb"),r=i("Lk4z"),d=i("NYxO"),c={computed:s()({},Object(d.b)(["deptList"])),methods:{handleNodeClick:function(e){this.$emit("selectDept",e)},add:function(){this.$emit("addnode")}}},p={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"dept"},[t("el-row",{staticClass:"team",attrs:{"in-line":"true"}},[t("p",[this._v("组织架构")]),this._v(" "),t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:this.add}},[this._v("新建部门")])],1),this._v(" "),t("el-row",[t("el-tree",{attrs:{data:this.deptList,"default-expand-all":"","expand-on-click-node":!1},on:{"node-click":this.handleNodeClick}})],1)],1)},staticRenderFns:[]};var u=i("VU/8")(c,p,!1,function(e){i("+wd3")},"data-v-4d5d8d8a",null).exports,h={computed:s()({},Object(d.b)({pageSize:function(e){return e.pageSize},page:function(e){return e.page},selectDept:function(e){return e.selectDept},roleList:function(e){return e.roleList}})),components:{Form:l.a,Table:r.a,Dept:u},data:function(){var e=this;return{editType:"add",isShow:!1,allupdateShow:!1,bothForm:{dept:"",identity:""},bothLabel:[{model:"dept",label:"部门",type:"treeSelect"},{model:"identity",label:"角色",type:"select"}],editForm:{name:"",uname:"",upwd:"",ustate:"",sex:"",dept:"",identity:"",phone:""},editLabel:[{model:"name",label:"姓名",type:"input"},{model:"uname",label:"用户名",type:"input",disabled:!0},{model:"upwd",label:"密码",type:"password"},{model:"checkupwd",label:"确认密码",type:"password"},{model:"sex",label:"性别",type:"radio",radio:[{label:"男",value:1},{label:"女",value:0}]},{model:"ustate",label:"状态",type:"switch"},{model:"dept",label:"部门",type:"treeSelect"},{model:"identity",label:"角色",type:"select"},{model:"phone",label:"号码",type:"input"}],deptList:[{id:"1",label:"上海",children:[{id:"2",label:"销售部"}]}],deptForm:{dept:"",dname:""},deptLabel:[{model:"dept",label:"上级部门",type:"treeSelect"},{model:"dname",label:"部门名称",type:"input"}],identityList:[{id:"1",label:"部门经理"},{id:"2",label:"员工"}],seachForm:{dept:"",keyword:""},formLabel:[{model:"dept",label:"部门",type:"treeSelect"},{model:"keyword",label:"用户名",type:"input"}],tableData:[],tableLabel:[{prop:"name",label:"姓名"},{prop:"uname",label:"用户名"},{prop:"state",label:"状态"},{prop:"sexy",label:"性别"},{prop:"dept",label:"部门"},{prop:"identity",label:"角色"},{prop:"phone",label:"手机号码"}],config:{page:1,pageSize:null,total:25,loading:!1,type:"编辑"},rules:{name:[{required:!0,message:"请输入姓名",trigger:"blur"}],uname:[{required:!0,validator:function(t,i,a){if("add"!=e.editType)return a();if(!i)return a(new Error("请输入用户名"));if(!/^[a-z0-9]{3,12}$/.test(i))return a(new Error("英文或数字，长度再3-12之间"));var o="uname="+i;e.axios.post("http://127.0.0.1:3000/check",o).then(function(e){return-1==e.data.code?a(new Error("用户名已被注册")):a()})},trigger:"blur"}],upwd:[{required:!0,validator:function(t,i,a){if("add"==e.editType){if(!i)return a(new Error("请输入密码"));if(!/^(?=.*\d)(?=.*[a-z])(?=.*[~!@#$%^&*])[\da-z~!@#$%^&*]{6,12}$/.test(i))return a(new Error("必须包含数字、字母、特殊符号，长度在6-12之间"));a()}},trigger:"blur"}],checkupwd:[{required:!0,validator:function(t,i,a){if("add"==e.editType){if(!i)return a(new Error("请在此输入密码"));i!=e.editForm.upwd?(console.log(e.editForm.upwd),a(new Error("两次输入密码不一致"))):a()}},trigger:"blur"}],sex:[{required:!0,message:"请选择性别",trigger:"change"}],dept:[{required:!0,message:"请选择部门",trigger:"change"}],identity:[{required:!0,message:"请选择角色",trigger:"change"}],phone:[{required:!0,message:"请输入手机号码",trigger:"blur"}]},arr:[],tableList:[]}},methods:{getJsonTree:function(e,t){for(var i=[],a=0;a<e.length;a++){var o=e[a];if(o.parent==t){var n={id:o.did,label:o.dname,children:this.getJsonTree(e,o.did)};i.push(n)}}return i},getDeptList:function(){var e=this;this.axios.get("http://127.0.0.1:3000/getDept").then(function(t){var i=e.getJsonTree(t.data.data,"");e.deptList=i,e.$store.commit("setDept",i)})},getSubDept:function(e){var t=this;return e&&(this.arr.push(e.label),e.children&&e.children.forEach(function(e){t.getSubDept(e)})),this.arr.join("','")},addnode:function(){this.isShow=!0,this.editType="addDept",this.editLabel=this.deptLabel,this.editForm=this.deptForm},select:function(e){var t=this.getSubDept(e);console.log(t),this.$store.commit("saveDept",t),this.$store.commit("changePage",1),this.config.page=this.page,this.getUser(),this.arr=[]},getUser:function(){var e=this;this.config.loading=!0;var t="http://127.0.0.1:3000/userList?page="+this.page+"&pageSize="+this.pageSize+"&dept="+this.selectDept;this.axios.get(t).then(function(t){var i=t.data.data.data;e.config.total=t.data.data.total,e.tableData=i.map(function(e){return e.ustate=1===e.ustate,e.sexy=1===e.sex?"男":"女",e}),console.log(e.tableData),e.config.loading=!1})},edit:function(e){this.isShow=!0,this.editType="edit",this.editLabel=this.editLabel.filter(function(e){return"password"==e.type&&(e=null),e}),this.editForm=o()({},e)},submit:function(){var e=this;this.$refs.formEdit.$refs.subFormEdit.validate(function(t){if(console.log(t),t){e.editForm.sexy="1"==e.editForm.sex?"男":"女";var i="";"add"==e.editType?(e.editForm.sexy="",i="http://127.0.0.1:3000/register"):i="edit"==e.editType?"http://127.0.0.1:3000/editUserInfo":"http://127.0.0.1:3000/addDept";var a=e.qs.stringify(e.editForm);console.log(e.editForm),e.axios.post(i,a).then(function(t){1==t.data.code?(e.$message({showClose:!0,type:"success",message:t.data.msg}),e.closeEvent(),e.getUser(),e.getDeptList()):e.$message({showClose:!0,type:"warning",message:t.data.msg})})}})},del:function(e){var t=this;this.$confirm("此操作将永久删除该用户，是否继续","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var i=t.qs.stringify(e);t.axios.post("http://127.0.0.1:3000/deleteUser",i).then(function(e){1==e.data.code?(t.$message({showClose:!0,type:"success",message:e.data.msg}),t.getUser()):t.$message.error(e.data.msg)})}).catch(function(){t.$message({type:"info",message:"已取消删除"})})},add:function(){this.isShow=!0,this.editForm.ustate=!0,this.editForm.sex=1,this.editType="add"},changeState:function(e){console.log(e);var t=this.qs.stringify(e);console.log(t);this.axios.post("http://127.0.0.1:3000/editUserInfo",t).then(function(e){})},closeEvent:function(){this.isShow=!1,this.allupdateShow=!1,this.editForm={name:"",uname:"",ustate:!0,upwd:"",sex:"",dept:"",identity:"",phone:""},this.editLabel=[{model:"name",label:"姓名",type:"input"},{model:"uname",label:"用户名",type:"input",disabled:!0},{model:"upwd",label:"密码",type:"password"},{model:"checkupwd",label:"确认密码",type:"password"},{model:"sex",label:"性别",type:"radio",radio:[{label:"男",value:1},{label:"女",value:0}]},{model:"ustate",label:"状态",type:"switch"},{model:"dept",label:"部门",type:"treeSelect"},{model:"identity",label:"角色",type:"select"},{model:"phone",label:"号码",type:"input"}],this.deptForm={dept:"",dname:""},this.bothLabel=[{model:"dept",label:"部门",type:"treeSelect"},{model:"identity",label:"角色",type:"select"}],this.bothForm={dept:"",identity:""}},selectTable:function(e){var t=this;this.tableList=[],e.forEach(function(e){t.tableList.push(e.uname)}),console.log(this.tableList)},bothIdentity:function(){this.allupdateShow=!0,this.bothLabel=this.bothLabel.filter(function(e){return"dept"==e.model&&(e=null),e})},bothDept:function(){this.allupdateShow=!0,this.bothLabel=this.bothLabel.filter(function(e){return"identity"==e.model&&(e=null),e})},bothSubmit:function(){var e=this;this.config.loading=!0,this.$refs.updateForm.$refs.subFormEdit.validate(function(t){if(t){var i=e.tableList.join("','");e.bothForm.tableData=i,console.log(e.bothForm);var a=e.qs.stringify(e.bothForm);e.axios.post("http://127.0.0.1:3000/bothUpdate",a).then(function(t){1==t.data.code?(e.$message({type:"success",showClose:!0,message:t.data.msg}),e.closeEvent(),e.getUser()):e.$message({type:"warning",showClose:!0,message:t.data.msg})})}}),this.config.loading=!1},search:function(){}},created:function(){this.getUser(),this.getDeptList()}},g={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-row",{staticClass:"user"},[e.isShow?i("el-dialog",{attrs:{title:"addDept"==e.editType?"新建部门":"add"==e.editType?"新增用户":"编辑用户",visible:e.isShow,"close-on-click-modal":!1},on:{"update:visible":function(t){e.isShow=t},close:e.closeEvent}},[i("Form",{ref:"formEdit",staticClass:"edit",attrs:{formLabel:e.editLabel,seachForm:e.editForm,rules:e.rules,editType:e.editType},on:{"update:editType":function(t){e.editType=t},"update:edit-type":function(t){e.editType=t}}}),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:e.closeEvent}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v("确 定")])],1)],1):e._e(),e._v(" "),e.allupdateShow?i("el-dialog",{staticClass:"both",attrs:{title:"批量修改",width:"30%",visible:e.allupdateShow},on:{"update:visible":function(t){e.allupdateShow=t},close:e.closeEvent}},[i("Form",{ref:"updateForm",attrs:{formLabel:e.bothLabel,seachForm:e.bothForm,deptList:e.deptList,identityList:e.identityList,rules:e.rules}}),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:e.closeEvent}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.bothSubmit}},[e._v("保存")])],1)],1):e._e(),e._v(" "),i("el-col",{staticClass:"left",attrs:{span:4}},[i("Dept",{on:{selectDept:e.select,addnode:e.addnode}})],1),e._v(" "),i("el-col",{staticClass:"right",attrs:{span:20}},[i("div",{staticClass:"form"},[i("div",[i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.add}},[e._v("新增")]),e._v(" "),i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.bothIdentity}},[e._v("修改角色")]),e._v(" "),i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.bothDept}},[e._v("修改部门")])],1),e._v(" "),i("Form",{attrs:{formLabel:e.formLabel,seachForm:e.seachForm,deptList:e.deptList}},[i("el-button",{attrs:{type:"primary",size:"mini"}},[e._v("搜索")])],1)],1),e._v(" "),i("Table",{staticClass:"table",attrs:{tableData:e.tableData,tableLabel:e.tableLabel,config:e.config},on:{changePage:e.getUser,changeSizePage:e.getUser,edit:e.edit,del:e.del,changState:e.changeState,selectRow:e.selectTable}})],1)],1)},staticRenderFns:[]};var m=i("VU/8")(h,g,!1,function(e){i("YMOT")},"data-v-fafb8b18",null);t.default=m.exports}});
//# sourceMappingURL=7.37d8e7b44fa74420a3ec.js.map